<main>
  <mat-toolbar color="primary">
    <span>{{ layoutDetails.displayName }}</span>
    <span class="example-spacer"></span>
    <span>hi</span>
    <!-- <mat-icon class="example-icon" aria-hidden="false" aria-label="Example user verified icon">verified_user</mat-icon> -->
  </mat-toolbar>

  <div class="wrap">
    <article class="grid">
      <!-- @TODO turn flex width expression into a function or better-->
      <section *ngFor="let ld of layoutDetails.layout" [ngStyle]="{'width': (ld.width / 12 * 100) + '%'}">
        <h4>      
          {{ ld.label }}
        </h4>
        <div *ngIf="ld.type === 'DATA_POINT'; else elseBlock">
          <div class="grid">
            <div *ngFor="let elem of ld.elements" [ngStyle]="{'width': (elem.width / 12 * 100) + '%'}">
              <h5 class="data-label">{{ layoutDetails.fieldDefinitions[elem.name].label }}</h5>
              <div class="data-val">{{ metricData.dataPoints[elem.name] | metricFormatPipe: layoutDetails.fieldDefinitions[elem.name]}}</div>
            </div>
          </div>
        </div>
  
        <ng-template #elseBlock>
          <!-- @TODO fix selecting array item by 0  index feels dirty but there is only one -->
          <!-- @TODO footer row for accumulating data -->
          <div>
            <table mat-table [dataSource]="metricData.dataSets[0].data">            
              <ng-container *ngFor="let f of ld.elements[0].fields"  [matColumnDef]="f.name">
                <th mat-header-cell *matHeaderCellDef> {{ layoutDetails.fieldDefinitions[f.name].label }}</th>
                <td mat-cell *matCellDef="let row"> {{ row[f.name] }} </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="tableCols"></tr>
              <tr mat-row *matRowDef="let rowData; columns: tableCols"></tr>
            </table>
          </div>
        </ng-template>

      </section>
    </article>
  </div>
</main>
